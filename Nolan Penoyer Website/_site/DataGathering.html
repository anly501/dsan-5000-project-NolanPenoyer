<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Nolan Penoyer Website - Data Gathering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Nolan Penoyer Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./DataGathering.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DataCleaning.html" rel="" target="">
 <span class="menu-text">Data Cleaning</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DataExploration.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NaiveBayes.html" rel="" target="">
 <span class="menu-text">NaiveBayes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Clustering.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DimensionalityReduction.html" rel="" target="">
 <span class="menu-text">Dimensionaility Reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./DecisionTrees.html" rel="" target="">
 <span class="menu-text">Decision Trees</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#census-data" id="toc-census-data" class="nav-link active" data-scroll-target="#census-data">Census Data</a></li>
  <li><a href="#home-value-data" id="toc-home-value-data" class="nav-link" data-scroll-target="#home-value-data">Home Value Data</a></li>
  <li><a href="#news-data" id="toc-news-data" class="nav-link" data-scroll-target="#news-data">News Data</a></li>
  <li><a href="#reddit-data" id="toc-reddit-data" class="nav-link" data-scroll-target="#reddit-data">Reddit Data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Gathering</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="census-data" class="level1">
<h1>Census Data</h1>
<p>I will attempt to gather all the data I need to answer my 10 questions. Most of the data I acquire will come from <a href="https://www.census.gov/">census.gov</a>. I will use data tables from the U.S. Census Bureau’s <a href="https://www.census.gov/data/developers/data-sets/ACS-supplemental-data.html">American Community Survey</a> (ACS), a nationwide survey that collects and produces information on social, economic, housing, and demographic characteristics about our nation’s population each year.</p>
<p>I chose census data and specifically the ACS tables because, from experience and knowledge I have accumulated in my life, I inferred that the variables in these tables could be useful in predicting home prices. For example, one variable I will examine is the number of people with bachelor’s degrees. Usually, higher education is linked to higher incomes, and therefore, higher home prices. The variables I choose to include from the tables may prove valuable or they may not; part of my analysis is determining which variables are the most important. Also, a lot of my variables are heavily correlated with each other, like total households and total married households. This can become an issue in the models I create as multicollinearity increases variance and makes it hard to know the impact of an individual variable in the model. I am aware of this and will address it later in my project.</p>
<p>I will import the DP02-DP05 tables from 2017-2022, excluding 2020 because there was not accurate data that year due to COVID. Ultimately, I will not need all the columns in the tables, but it will be nice to have easy access to them in my future analysis. I only went back to 2017 for now, but if I wanted to improve my models, I could retrieve more data. The same methodology will apply no matter how much data I acquire.</p>
<p>Here are what the ACS tables contain:<br> DP02: Selected Social Characteristics in the United States <br> DP03: Selected Economic Characteristics in the United States <br> DP04: Selected Housing Characteristics <br> DP05: ACS Demographic and Housing Estimates</p>
<p>Using the API, you can query different geography hierarchies, like if you want data on regions in the U.S. or, in my analysis, on U.S. states.</p>
<p>I will start by retreiving one table to see what we are working with.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>import requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>import json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>import re</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>DP02_URL_2017<span class="ot">=</span><span class="st">"https://api.census.gov/data/2017/acs/acs1/profile?get=group(DP02)&amp;for=state:*"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>DP02_2017<span class="ot">=</span> <span class="fu">requests.get</span>(DP02_URL_2017)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>DP02_2017 <span class="ot">=</span> <span class="fu">DP02_2017.json</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>DP02_2017<span class="ot">=</span><span class="fu">pd.DataFrame</span>(DP02_2017)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">DP02_2017.head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">1209</th>
<th data-quarto-table-cell-role="th">1210</th>
<th data-quarto-table-cell-role="th">1211</th>
<th data-quarto-table-cell-role="th">1212</th>
<th data-quarto-table-cell-role="th">1213</th>
<th data-quarto-table-cell-role="th">1214</th>
<th data-quarto-table-cell-role="th">1215</th>
<th data-quarto-table-cell-role="th">1216</th>
<th data-quarto-table-cell-role="th">1217</th>
<th data-quarto-table-cell-role="th">1218</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DP02_0001E</td>
<td>DP02_0001EA</td>
<td>DP02_0001M</td>
<td>DP02_0001MA</td>
<td>DP02_0001PE</td>
<td>DP02_0001PEA</td>
<td>DP02_0001PM</td>
<td>DP02_0001PMA</td>
<td>DP02_0002E</td>
<td>DP02_0002EA</td>
<td>...</td>
<td>DP02_0152EA</td>
<td>DP02_0152M</td>
<td>DP02_0152MA</td>
<td>DP02_0152PE</td>
<td>DP02_0152PEA</td>
<td>DP02_0152PM</td>
<td>DP02_0152PMA</td>
<td>GEO_ID</td>
<td>NAME</td>
<td>state</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1091980</td>
<td>None</td>
<td>9693</td>
<td>None</td>
<td>1091980</td>
<td>None</td>
<td>-888888888</td>
<td>(X)</td>
<td>716451</td>
<td>None</td>
<td>...</td>
<td>None</td>
<td>9854</td>
<td>None</td>
<td>73.4</td>
<td>None</td>
<td>0.6</td>
<td>None</td>
<td>0400000US28</td>
<td>Mississippi</td>
<td>28</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2385135</td>
<td>None</td>
<td>13054</td>
<td>None</td>
<td>2385135</td>
<td>None</td>
<td>-888888888</td>
<td>(X)</td>
<td>1527260</td>
<td>None</td>
<td>...</td>
<td>None</td>
<td>15052</td>
<td>None</td>
<td>81.3</td>
<td>None</td>
<td>0.4</td>
<td>None</td>
<td>0400000US29</td>
<td>Missouri</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>423091</td>
<td>None</td>
<td>4068</td>
<td>None</td>
<td>423091</td>
<td>None</td>
<td>-888888888</td>
<td>(X)</td>
<td>262726</td>
<td>None</td>
<td>...</td>
<td>None</td>
<td>4698</td>
<td>None</td>
<td>81.3</td>
<td>None</td>
<td>0.9</td>
<td>None</td>
<td>0400000US30</td>
<td>Montana</td>
<td>30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>754490</td>
<td>None</td>
<td>4583</td>
<td>None</td>
<td>754490</td>
<td>None</td>
<td>-888888888</td>
<td>(X)</td>
<td>484989</td>
<td>None</td>
<td>...</td>
<td>None</td>
<td>6206</td>
<td>None</td>
<td>84.4</td>
<td>None</td>
<td>0.5</td>
<td>None</td>
<td>0400000US31</td>
<td>Nebraska</td>
<td>31</td>
</tr>
</tbody>
</table>

<p>5 rows × 1219 columns</p>
</div>
</div>
</div>
<p>The column names do not tell us much right now because they are codes that match to different variable labels in the census data. For example, DP02_0001E maps to total household counts. In the data cleaning section, we will be sure to give each column a proper label that tells us what the column represents. Also in the data cleaning section, we will only keep a select few columns out of the over 1000 columns in the tables.</p>
<p>I will use the following loop to get each table I want and turn them into csv files for easy retrieval for the rest of my analysis. If you would like to see my csv files, please refer to this <a href="https://github.com/anly501/dsan-5000-project-NolanPenoyer/tree/main/Nolan%20Penoyer%20Website">GitHub Repository</a>.<br> <em>Nolan Penoyer Website/data</em> (Every file that starts with a year)</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="81">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>string<span class="ot">=</span><span class="st">'https://api.census.gov/data/2016/acs/acs1/profile?get=group(DP05)&amp;for=state'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>list1<span class="ot">=</span>[<span class="st">'2016'</span>,<span class="st">'2017'</span>,<span class="st">'2018'</span>,<span class="st">'2019'</span>,<span class="st">'2021'</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>list2<span class="ot">=</span>[<span class="st">'2017'</span>,<span class="st">'2018'</span>,<span class="st">'2019'</span>,<span class="st">'2021'</span>,<span class="st">'2022'</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>list3<span class="ot">=</span>[<span class="st">'DP01'</span>,<span class="st">'DP02'</span>,<span class="st">'DP03'</span>,<span class="st">'DP04'</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>list4<span class="ot">=</span>[<span class="st">'DP02'</span>,<span class="st">'DP03'</span>,<span class="st">'DP04'</span>,<span class="st">'DP05'</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">5</span>)<span class="sc">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    string<span class="ot">=</span><span class="fu">string.replace</span>(<span class="st">'DP05'</span>,list3[<span class="dv">0</span>])</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> w <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">4</span>)<span class="sc">:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        file<span class="ot">=</span><span class="st">'./data/'</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        csv<span class="ot">=</span><span class="st">'.csv'</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        name<span class="ot">=</span>file<span class="sc">+</span>list2[i]<span class="sc">+</span>list4[w]<span class="sc">+</span>csv</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        csvname<span class="ot">=</span>file<span class="sc">+</span>list2[i]<span class="sc">+</span>list3[w]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        string<span class="ot">=</span><span class="fu">string.replace</span>(list1[i],list2[i])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        string<span class="ot">=</span><span class="fu">string.replace</span>(list3[w],list4[w])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        response<span class="ot">=</span><span class="fu">requests.get</span>(string)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        response <span class="ot">=</span> <span class="fu">response.json</span>()</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        df<span class="ot">=</span><span class="fu">pd.DataFrame</span>(response)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">df.to_csv</span>(name, <span class="at">index=</span>False)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="home-value-data" class="level1">
<h1>Home Value Data</h1>
<p>My home value data comes from <a href="https://www.zillow.com/research/data/">Zillow</a>. Specifically, I will use Zillow’s Home Value Index (ZHVI), which reflects the typical value of homes in the 35th to 65th percentile, a home that will be in my price range. The ZHVI was created to accurately capture the seasonally adjusted value of a typical property across the nation as opposed to just the homes that sold. If you would like to learn more about how Zillow calculates this value and why it is a more accurate measure of home value as opposed to other alternatives like median home price, you can visit the link I provided.</p>
<p>Zillow has an API, but since it was one table I needed, I downloaded the csv file. Like my census data, I calculated this data on the state level for years 2017-2022, excluding 2020. If you would like to see my csv file, please refer to this <a href="https://github.com/anly501/dsan-5000-project-NolanPenoyer/tree/main/Nolan%20Penoyer%20Website">GitHub Repository</a>.<br> <em>Nolan Penoyer Website/data</em> (Zillow.csv))</p>
</section>
<section id="news-data" class="level1">
<h1>News Data</h1>
<p>Although not a focus of my project, news headline text data could potentially provide us with some insight on the sentiment of the real estate market and therefore what direction the general population thinks home prices are heading. The overall sentiment can provide us with signals that people are overvaluing or undervaluing homes, or that a rise or drop in home prices may be pending. Knowing if the general public believes buying a home, especially in a certain state, is a smart decision, can tell us which direction prices are headed, depending if you agree with the general public or not. Another potential data science project I would like to study in the future is if market sentiment matches market performance, and if there is a lag between the two.</p>
<p>I will use the <a href="https://newsapi.org/">news API</a> to search and retreive live articles from across the web. I will only search for articles that contain “Real Estate” in the headline. If you would like to see my csv file, please refer to this <a href="https://github.com/anly501/dsan-5000-project-NolanPenoyer/tree/main/Nolan%20Penoyer%20Website">GitHub Repository</a>.<br> <em>Nolan Penoyer Website/data</em> (news.csv))</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>import requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>import json</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>import re</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>from sklearn.feature_extraction.text import CountVectorizer</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">=</span> <span class="st">"https://newsapi.org/v2/everything?"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>total_requests<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>verbose<span class="ot">=</span>True</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>API_KEY<span class="ot">=</span><span class="st">'6a2b4aca491e4bedb90a4c7275f2ddf6'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>TOPIC<span class="ot">=</span><span class="st">'Real Estate'</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>URLpost <span class="ot">=</span> {<span class="st">'apiKey'</span><span class="sc">:</span> API_KEY,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'q'</span><span class="sc">:</span> <span class="st">'+'</span><span class="sc">+</span>TOPIC,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sortBy'</span><span class="sc">:</span> <span class="st">'relevancy'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'totalRequests'</span><span class="sc">:</span> <span class="dv">1</span>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#print(baseURL)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>response <span class="ot">=</span> <span class="fu">requests.get</span>(baseURL, URLpost)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>response <span class="ot">=</span> <span class="fu">response.json</span>()</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>def <span class="fu">string_cleaner</span>(input_string)<span class="sc">:</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    try<span class="sc">:</span> </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="fu">re.sub</span>(r<span class="st">"""</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="st">                    [,.;@#?!&amp;$-]+  # Accept one or more copies of punctuation</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="st">                    \ *           # plus zero or more copies of a space,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="st">                    """</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">" "</span>,          <span class="co"># and replace it with a single space</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                    input_string, <span class="at">flags=</span>re.VERBOSE)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#REPLACE SELECT CHARACTERS WITH NOTHING</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        out <span class="ot">=</span> <span class="fu">re.sub</span>(<span class="st">'[’.]+'</span>, <span class="st">''</span>, input_string)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ELIMINATE DUPLICATE WHITESPACES USING WILDCARDS</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        out <span class="ot">=</span> <span class="fu">re.sub</span>(r<span class="st">'\s+'</span>, <span class="st">' '</span>, out)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">#CONVERT TO LOWER CASE</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="fu">out.lower</span>()</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    except<span class="sc">:</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("ERROR")</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="st">''</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    return out</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>article_list<span class="ot">=</span>response[<span class="st">'articles'</span>]   <span class="co">#list of dictionaries for each article</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>article_keys<span class="ot">=</span>article_list[<span class="dv">0</span>]<span class="fu">.keys</span>()</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">#print("AVAILABLE KEYS:")</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">#print(article_keys)</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>index<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>cleaned_data<span class="ot">=</span>[];  </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> article <span class="cf">in</span> article_list<span class="sc">:</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    tmp<span class="ot">=</span>[]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="cf">in</span> article_keys<span class="sc">:</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(key<span class="sc">==</span><span class="st">'source'</span>)<span class="sc">:</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>            src<span class="ot">=</span><span class="fu">string_cleaner</span>(article[key][<span class="st">'name'</span>])</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tmp.append</span>(src) </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(key<span class="sc">==</span><span class="st">'author'</span>)<span class="sc">:</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>            author<span class="ot">=</span><span class="fu">string_cleaner</span>(article[key])</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>            <span class="co">#ERROR CHECK (SOMETIMES AUTHOR IS SAME AS PUBLICATION)</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(src <span class="cf">in</span> author)<span class="sc">:</span> </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tmp.append</span>(author)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(key<span class="sc">==</span><span class="st">'title'</span>)<span class="sc">:</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tmp.append</span>(<span class="fu">string_cleaner</span>(article[key]))</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(key=='description'):</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     tmp.append(string_cleaner(article[key]))</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(key=='content'):</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     tmp.append(string_cleaner(article[key]))</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(key<span class="sc">==</span><span class="st">'publishedAt'</span>)<span class="sc">:</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>            <span class="co">#DEFINE DATA PATERN FOR RE TO CHECK  .* --&gt; wildcard</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>            ref <span class="ot">=</span> <span class="fu">re.compile</span>(<span class="st">'.*-.*-.*T.*:.*:.*Z'</span>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>            date<span class="ot">=</span>article[key]</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(not <span class="fu">ref.match</span>(date))<span class="sc">:</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>                <span class="fu">print</span>(<span class="st">" DATE ERROR:"</span>,date); date<span class="ot">=</span><span class="st">"NA"</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tmp.append</span>(date)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cleaned_data.append</span>(tmp)</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    index<span class="sc">+</span><span class="er">=</span><span class="dv">1</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">pd.DataFrame</span>(cleaned_data)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="fu">df.head</span>()</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="fu">df.to_csv</span>(<span class="st">'./data/news.csv'</span>, <span class="at">index=</span>False) <span class="co">#,index_label=['title','src','author','date','description'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df.head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>lifehackercom</td>
<td>elizabeth yuko</td>
<td>what to do if your home inspector missed a maj...</td>
<td>2023-11-12T18:00:00Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>slashdotorg</td>
<td>msmash</td>
<td>almost no one pays a 6% real-estate commission...</td>
<td>2023-11-17T18:40:00Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>business insider</td>
<td>george glover</td>
<td>real estate made china rich now it's looking m...</td>
<td>2023-11-16T10:11:14Z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>business insider</td>
<td>cork gaines</td>
<td>baby boomers got rich off real estate and they...</td>
<td>2023-11-19T10:32:01Z</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>business insider</td>
<td>theron mohamed</td>
<td>stocks may crash 30%, a recession looks immine...</td>
<td>2023-11-19T11:30:01Z</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here I will use an API in R to retreive text data that can give me some insight into some real estate trends and what states people are talking about.</p>
</section>
<section id="reddit-data" class="level1">
<h1>Reddit Data</h1>
<p>I can also retrieve Reddit text data for the same reason. Reddit comments are a more accurate measure of what the public believes than news data as there are no biases and incentives from corporations to report news a certain way. I also can break up the text data by state, which I attempted to do below. I need to find a work around as Reddit limits how many requests you are allowed in a period of time. I will not use Reddit data for the rest of this project.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RedditExtractoR)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span>, <span class="st">"Alaska"</span>, <span class="st">"Arizona"</span>, <span class="st">"Arkansas"</span>, <span class="st">"California"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Colorado"</span>, <span class="st">"Connecticut"</span>, <span class="st">"Delaware"</span>, <span class="st">"Florida"</span>, <span class="st">"Georgia"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hawaii"</span>, <span class="st">"Idaho"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Iowa"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span>, <span class="st">"Kentucky"</span>, <span class="st">"Louisiana"</span>, <span class="st">"Maine"</span>, <span class="st">"Maryland"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"Michigan"</span>, <span class="st">"Minnesota"</span>, <span class="st">"Mississippi"</span>, <span class="st">"Missouri"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Montana"</span>, <span class="st">"Nebraska"</span>, <span class="st">"Nevada"</span>, <span class="st">"New Hampshire"</span>, <span class="st">"New Jersey"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Mexico"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"North Dakota"</span>, <span class="st">"Ohio"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oklahoma"</span>, <span class="st">"Oregon"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Rhode Island"</span>, <span class="st">"South Carolina"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Dakota"</span>, <span class="st">"Tennessee"</span>, <span class="st">"Texas"</span>, <span class="st">"Utah"</span>, <span class="st">"Vermont"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Virginia"</span>, <span class="st">"Washington"</span>, <span class="st">"West Virginia"</span>, <span class="st">"Wisconsin"</span>, <span class="st">"Wyoming"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>text<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>subreddit<span class="ot">=</span><span class="st">"RealEstate"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (state <span class="cf">in</span> states){</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    state_df<span class="ot">&lt;-</span> <span class="fu">find_thread_urls</span>(<span class="at">keywords =</span> state,<span class="at">subreddit=</span>subreddit, <span class="at">sort_by=</span><span class="st">"top"</span>, <span class="at">period =</span> <span class="st">'year'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    state_df<span class="ot">&lt;-</span>state_df<span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">State=</span>state)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    text<span class="ot">&lt;-</span><span class="fu">rbind</span>(text,state_df)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>